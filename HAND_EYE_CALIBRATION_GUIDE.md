# 手眼标定端口占用问题解决方案

## 问题描述
当使用 `robot_ui.py` 控制机器人移动时，会占用机器人的TCP连接端口（默认29999端口），导致 `calibration_eye_hand.py` 无法同时连接获取机器人位姿。

## 解决方案

### 方案1：使用示教器控制（最简单，推荐）

**步骤：**
1. 关闭 `robot_ui.py`
2. 使用机器人自带的示教器/示教盒来移动机器人
3. 运行 `calibration_eye_hand.py` 进行数据采集
4. 在每个位姿时按 'c' 键采集数据

**优点：**
- 不需要修改代码
- 避免端口冲突
- 可以更精确地控制机器人位姿

**缺点：**
- 需要手持示教器操作

---

### 方案2：先移动后采集

**工作流程：**
```
1. 运行 robot_ui.py → 移动机器人到目标位姿 → 关闭 robot_ui.py
2. 运行 calibration_eye_hand.py → 按 'c' 采集当前位姿数据
3. 关闭 calibration_eye_hand.py
4. 重复步骤 1-3，直到采集足够数据
```

**优点：**
- 不需要修改代码
- 可以使用GUI控制

**缺点：**
- 操作繁琐，需要反复启动/关闭程序

---

### 方案3：创建轻量级控制脚本（推荐用于自动化）

我为你创建了一个新脚本，它可以：
1. 连接机器人
2. 移动到预设位姿
3. 立即断开连接
4. 让出端口给标定程序

**使用方法：**
```bash
# 使用预设位姿移动
python move_robot_preset.py

# 或者手动指定位姿
python move_robot_preset.py --x 600 --y -260 --z 380 --rx 170 --ry 12 --rz 140
```

---

### 方案4：修改robot_ui.py支持共享模式（高级）

通过修改代码实现"连接-操作-断开"的模式，而不是持续占用连接。

---

### 方案5：使用Dobot反馈端口（仅读取，适用于部分场景）

某些Dobot机器人支持通过30004反馈端口获取状态信息，该端口可以多客户端连接。

---

## 推荐工作流程

### 对于手动标定（推荐）：
```
1. 关闭所有机器人连接程序
2. 运行 calibration_eye_hand.py
3. 使用示教器移动机器人到不同位姿
4. 在每个位姿按 'c' 键采集数据
5. 采集完成后退出
```

### 对于半自动标定：
```
1. 修改下面的 move_robot_preset.py 脚本
2. 定义一组预设位姿
3. 运行脚本自动移动并采集
```

---

## 注意事项

1. **安全第一**：移动机器人时确保工作空间安全
2. **位姿多样性**：采集的位姿应该覆盖不同的角度和位置
3. **棋盘格可见**：每个位姿都要确保相机能清晰看到棋盘格
4. **避免端口冲突**：同一时间只能有一个程序连接控制端口(29999)

---

## 常见错误

### "Connection refused" 或 "连接失败"
- 检查是否有其他程序占用端口
- 确认机器人IP地址正确
- 检查网络连接

### "机器人未连接"
- 确保在采集数据前机器人已正确连接并启用
- 检查 robot.connected 和 robot.enabled 状态

### 采集数据时机器人位姿获取失败
- 确保没有其他程序占用29999端口
- 尝试重启机器人控制器
