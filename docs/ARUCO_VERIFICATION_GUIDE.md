# ArUco手眼标定验证指南

## 概述

本指南介绍如何使用ArUco标记验证手眼标定精度。通过检测8x8cm的ArUco板子，计算目标位置，然后移动机器人到该位置来验证手眼标定矩阵的准确性。

## 文件说明

### 主要程序文件

1. **`aruco_hand_eye_verification.py`** - 完整的验证程序
   - 支持手动和自动验证模式
   - 提供详细的精度统计
   - 保存验证结果

2. **`simple_aruco_test.py`** - 简化版验证程序
   - 快速测试和验证
   - 适合初学者使用

### 依赖文件

- `best_hand_eye_calibration.npy` - 手眼标定矩阵文件
- `lib/camera.py` - 相机控制模块
- `lib/dobot.py` - 机器人控制模块

## 准备工作

### 1. 硬件要求

- Intel RealSense相机 (D435/D455等)
- Dobot机械臂
- 8x8cm ArUco标记板
- 稳定的网络连接

### 2. 软件环境

确保已安装以下Python包：
```bash
pip install opencv-python
pip install numpy
pip install scipy
pip install pyrealsense2
```

### 3. 标定文件

确保存在手眼标定矩阵文件 `best_hand_eye_calibration.npy`。如果不存在，请先运行 `test_calibration_methods.py` 进行手眼标定。

## 使用方法

### 方法一：完整验证程序

```bash
python aruco_hand_eye_verification.py
```

**操作说明：**
- 按 `s` 键：手动选择检测到的标记进行验证
- 按 `a` 键：自动验证所有检测到的标记
- 按 `r` 键：显示验证结果统计
- 按 `q` 键：退出程序

### 方法二：简化验证程序

```bash
python simple_aruco_test.py
```

**操作说明：**
- 按 `s` 键：检测并移动到ArUco标记位置
- 按 `q` 键：退出程序

## 验证原理

### 1. ArUco检测

程序使用OpenCV的ArUco模块检测图像中的标记：
- 检测标记的四个角点
- 估计标记的3D位姿（旋转和平移）

### 2. 坐标变换

将相机坐标系下的标记位姿转换为机器人坐标系：

```
T_base2marker = T_base2end × T_end2camera × T_camera2marker
```

其中：
- `T_base2end`：机器人当前位姿
- `T_end2camera`：手眼标定矩阵（从文件加载）
- `T_camera2marker`：相机检测到的标记位姿

### 3. 精度验证

- 计算目标位姿和实际位姿的差异
- 位置误差：欧几里得距离（毫米）
- 姿态误差：旋转角度差（度）

## 结果解读

### 精度标准

- **优秀**：位置误差 < 2mm，姿态误差 < 1°
- **良好**：位置误差 < 5mm，姿态误差 < 3°
- **可接受**：位置误差 < 10mm，姿态误差 < 5°

### 结果文件

验证结果会保存为 `.npy` 文件，包含：
- 目标位姿和实际位姿
- 位置和姿态误差
- 时间戳
- 标记ID

## 故障排除

### 常见问题

1. **无法检测到ArUco标记**
   - 检查光照条件
   - 确保标记完整可见
   - 调整相机距离（建议30-80cm）

2. **机器人移动失败**
   - 检查网络连接
   - 确认机器人使能状态
   - 检查目标位置是否在机器人工作空间内

3. **标定矩阵加载失败**
   - 确认 `best_hand_eye_calibration.npy` 文件存在
   - 检查文件是否损坏

### 调试技巧

1. **可视化调试**
   - 观察ArUco检测结果
   - 检查坐标轴方向是否正确

2. **逐步验证**
   - 先测试相机检测
   - 再测试坐标变换
   - 最后测试机器人移动

## 安全注意事项

1. **工作空间安全**
   - 确保机器人工作空间内无障碍物
   - 设置合适的移动速度

2. **紧急停止**
   - 随时准备按机器人急停按钮
   - 程序支持Ctrl+C中断

3. **位置限制**
   - 程序会自动在目标位置上方设置安全位置
   - 避免直接移动到可能碰撞的位置

## 扩展功能

### 自定义参数

可以修改以下参数：
- `marker_size`：ArUco标记尺寸
- `aruco_dict_type`：ArUco字典类型
- `camera_model`：相机型号
- `robot_ip`：机器人IP地址

### 批量验证

可以修改程序支持：
- 多个标记同时验证
- 不同尺寸标记
- 不同位置验证

## 技术支持

如遇到问题，请检查：
1. 硬件连接状态
2. 软件版本兼容性
3. 网络连接稳定性
4. 标定数据质量
